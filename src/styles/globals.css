@layer resets, tokens, base, components, utilities;

@import './tokens.css' layer(tokens);

@layer resets {
  *, *::before, *::after { box-sizing: border-box; }
  html, body { height: 100%; }
  body, h1, h2, h3, h4, p, ul, ol, figure { margin: 0; }
  ul[role='list'], ol[role='list'] { list-style: none; }
}

@layer base {
  :root[data-theme="dark"] { color-scheme: dark; }
  :root[data-theme="light"] { color-scheme: light; }
  :root[data-theme="hc"] { color-scheme: dark; }
  
  /* font switching via data-font attribute on html element */
  html[data-font="geist"] { --font-sans: var(--font-geist); }
  html[data-font="ibm-plex"] { --font-sans: var(--font-ibm-plex); }
  html[data-font="sf-pro"] { --font-sans: var(--font-sf-pro); }
  html[data-font="segoe"] { --font-sans: var(--font-segoe); }
  html[data-font="optimistic"] { --font-sans: var(--font-optimistic); }
  
  html { font-size: 16px; }
  body {
    font-family: var(--font-sans);
    background: radial-gradient(1200px 800px at 80% -200px, rgba(174, 0, 255, 0.12), transparent 55%),
                radial-gradient(1200px 800px at -10% 0%, rgba(0, 200, 255, 0.12), transparent 45%),
                var(--color-bg);
    color: var(--color-text);
    line-height: 1.65;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  .app-shell { display: grid; grid-template-rows: var(--header-h) 1fr auto; height: 100svh; overflow: hidden; }
  .site-header { height: var(--header-h); display: grid; align-items: center; }
  .site-footer { height: auto; }
  .app-main { overflow: auto; }
  .overlay-root { position: fixed; left: 0; right: 0; top: calc(var(--header-h) + env(safe-area-inset-top)); bottom: calc(env(safe-area-inset-bottom)); z-index: 20; pointer-events: none; }
  .overlay-panel { position: fixed; left: 24px; top: calc(var(--header-h) + var(--space-3) + env(safe-area-inset-top)); bottom: calc(var(--footer-h) + var(--space-3) + env(safe-area-inset-bottom)); width: var(--panel-width); pointer-events: auto; z-index: 21; transition: transform 200ms ease; }
  .overlay-panel[data-state="closed"] { transform: translateX(calc(-100% + var(--panel-handle))); }
  .overlay-panel .panel-handle { position: absolute; top: 12px; right: -12px; width: var(--panel-handle); height: var(--panel-handle); border-radius: 999px; display: grid; place-items: center; background: var(--color-bg-elev); border: var(--border); box-shadow: var(--shadow-1); }
  .overlay-panel--right { position: fixed; right: 24px; top: calc(var(--header-h) + var(--space-3) + env(safe-area-inset-top)); bottom: calc(var(--footer-h) + var(--space-3) + env(safe-area-inset-bottom)); width: 360px; pointer-events: auto; z-index: 21; transition: transform 200ms ease; }
  .overlay-panel--right[data-state="closed"] { transform: translateX(calc(100% - var(--panel-handle))); }
  .overlay-panel--right .panel-handle { position: absolute; top: 12px; left: -12px; width: var(--panel-handle); height: var(--panel-handle); border-radius: 999px; display: grid; place-items: center; background: var(--color-bg-elev); border: var(--border); box-shadow: var(--shadow-1); }
  .overlay-panel[data-state="closed"] .project-card, .overlay-panel--right[data-state="closed"] .project-card { pointer-events: none; }
  .project-pager { position: fixed; right: 24px; top: calc(var(--header-h) + 12px); display: flex; gap: 8px; pointer-events: auto; z-index: 22; }
  .pager-btn { display: grid; place-items: center; width: 36px; height: 36px; border-radius: 999px; background: var(--color-bg-elev); border: var(--border); box-shadow: var(--shadow-1); text-decoration: none; }
  /* two-pane scroll containment */
  .project-grid { min-height: calc(100% - var(--space-16) * 2); }
  .project-aside { position: sticky; top: 0; height: auto; }
  .project-aside > .project-card { height: 100%; overflow: auto; }
  .project-content-scroll { min-height: 100%; overflow: visible; padding-bottom: var(--space-8); }

  a { color: inherit; text-decoration: none; }
  a:hover { text-decoration: underline; }

  /* typography roles */
  .type-primary { font-size: var(--type-primary); }
  .type-secondary { font-size: var(--type-secondary); color: var(--color-muted); }
  .type-tertiary { font-size: var(--type-tertiary); color: var(--color-muted); }
  .eyebrow { text-transform: uppercase; letter-spacing: 0.08em; font-size: var(--size-0); color: var(--color-muted); }
  .h1 { font-size: var(--size-7); line-height: 1.1; font-weight: 600; }
  .h2 { font-size: var(--size-5); line-height: 1.2; font-weight: 600; }
  .h3 { font-size: var(--size-4); line-height: 1.25; font-weight: 600; }
  .lede { font-size: var(--size-3); color: var(--color-muted); }

  img, picture, video, canvas, svg { display: block; max-width: 100%; }
  input, button, textarea, select { font: inherit; color: inherit; }
}

@layer components {
  .container { width: min(100% - 32px, var(--content-width)); margin-inline: auto; }
  .container--fluid { width: calc(100% - 48px); max-width: none; margin-inline: auto; }
  header.site-header { position: sticky; top: 0; backdrop-filter: saturate(1.2) blur(8px); background: color-mix(in oklab, var(--color-bg), transparent 65%); border-bottom: var(--border-weak); z-index: 10; }
  .nav { display: flex; align-items: center; justify-content: space-between; padding: var(--space-3) 0; list-style: none; margin: 0; }
  .nav > li { list-style: none; }
  .nav a { padding: 8px 10px; border-radius: var(--radius-sm); display: inline-block; }
  .nav a:focus-visible { outline: var(--focus-ring); outline-offset: 3px; }
  a:focus-visible { outline: var(--focus-ring); outline-offset: 3px; border-radius: var(--radius-sm); }
  footer.site-footer { border-top: var(--border-weak); margin-top: var(--space-0); padding: var(--space-6) 0; color: var(--color-muted); position: sticky; bottom: 0; background: color-mix(in oklab, var(--color-bg), transparent 10%); backdrop-filter: saturate(1.1) blur(6px); }
  .footer-inner{display:flex;align-items:center;justify-content:space-between;gap:var(--space-3);flex-wrap:wrap}
  .footer-copy{white-space:nowrap}

  /* project layout */
  .project-grid { display: grid; grid-template-columns: 1fr; gap: var(--space-10); align-items: start; }
  .project-aside { position: sticky; top: 72px; align-self: start; height: calc(100svh - 72px); }
  .project-aside > .project-card { height: 100%; overflow: auto; }
  .project-card { background: var(--surface-card); border: var(--border-weak); border-radius: var(--radius-md); padding: var(--space-5); box-shadow: var(--shadow-1); }
  .project-meta { margin: 0; }
  .project-meta dt { color: var(--color-muted); font-size: var(--size-1); margin-top: var(--space-3); }
  .project-meta dd { margin: 2px 0 0 0; }
  .project-links { margin-top: var(--space-5); display: grid; gap: 6px; }
  .link-token { display: inline-flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 999px; background: color-mix(in oklab, var(--color-bg-elev), var(--surface-image-frame) 3%); border: var(--border); width: fit-content; }
  .link-token img { border-radius: 4px; }
  @media (max-width: 600px) {
    .link-token img { display: none; }
    .link-token { padding: 10px 14px; }
  }
  .project-section { margin-top: var(--space-8); }

  /* push content when left panel is active */
  /* shift only the scrollable content area when the left overlay is present */
  body.has-left-panel .app-main { padding-left: calc(var(--panel-width) + 48px); padding-bottom: var(--footer-h); transition: padding-left 200ms ease; }
  body.has-left-panel[data-left-panel="closed"] .app-main { padding-left: calc(var(--panel-handle) + 48px); }
  
  /* push content when right panel is active (grid page) */
  body.has-right-panel .app-main { padding-right: calc(360px + 48px); transition: padding-right 200ms ease; }
  body.has-right-panel[data-right-panel="closed"] .app-main { padding-right: calc(var(--panel-handle) + 48px); }
  @media (max-width: 900px) {
    body.has-left-panel .app-main { padding-left: 0; }
    body.has-right-panel .app-main { padding-right: 0; }
    /* lock background scroll when overlays are open on mobile */
    body.has-left-panel[data-left-panel="open"], body.has-right-panel[data-right-panel="open"] { overflow: hidden; }
    :root { --panel-handle: 44px; }
  }

  /* responsive panel sizing */
  @media (min-width: 1200px) {
    :root { --panel-width: 360px; }
  }
  .overlay-panel .project-card { padding-top: var(--space-6); }

  /* shared card styles */
  .card { background: var(--surface-card); border: var(--border-weak); border-radius: var(--radius-md); padding: var(--space-5); box-shadow: var(--shadow-1); display: block; text-decoration: none; color: inherit; transition: transform 140ms ease, box-shadow 140ms ease, border-color 140ms ease; }
  .card:hover, .card:focus-visible { transform: translateY(-2px); border: var(--border-strong); box-shadow: var(--shadow-2); }
  .card-image { position: relative; aspect-ratio: 3 / 2; margin-bottom: var(--space-3); overflow: hidden; border-radius: var(--radius-md); }
  .card-image img { object-fit: cover; }
}

@layer utilities {
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  /* footer icon buttons */
  .icon-links{display:flex;gap:var(--space-3);padding:0;margin:0;list-style:none;flex-wrap:wrap}
  .icon-btn{position:relative;display:grid;place-items:center;width:36px;height:36px;border-radius:999px;background:color-mix(in oklab, var(--color-bg-elev), transparent 20%);border:var(--border);box-shadow:var(--shadow-1);color:var(--color-text);text-decoration:none}
  .icon-btn:hover,.icon-btn:focus-visible{background:color-mix(in oklab, var(--color-bg-elev), transparent 5%);border:var(--border-strong)}
  .icon-btn .tooltip{position:absolute;bottom:42px;left:50%;transform:translateX(-50%) translateY(6px);opacity:0;pointer-events:none;transition:opacity 140ms ease, transform 140ms ease;background:var(--surface-card);border:var(--border);box-shadow:var(--shadow-2);color:var(--color-text);padding:6px 10px;border-radius:var(--radius-sm);font-size:var(--size-0);white-space:nowrap}
  .icon-btn:hover .tooltip,.icon-btn:focus-visible .tooltip{opacity:1;transform:translateX(-50%) translateY(0)}
  .icon-btn .tooltip::after{content:"";position:absolute;top:100%;left:50%;transform:translateX(-50%);border-width:6px;border-style:solid;border-color:var(--surface-card) transparent transparent transparent}
  @media (max-width: 700px){
    .footer-inner{justify-content:center}
    .footer-copy{width:100%;text-align:center;margin-bottom:var(--space-2)}
    footer.site-footer{margin-top: var(--space-2)}
  }
  @media (max-width: 520px){
    .icon-links{gap:var(--space-2)}
    .icon-btn{width:32px;height:32px}
    .icon-btn svg{width:16px;height:16px}
    .icon-btn .tooltip{display:none}
  }
  /* lightbox overlay */
  .lb-overlay{position:fixed;inset:0;background:color-mix(in oklab, #000, transparent 20%);backdrop-filter:saturate(1.1) blur(6px);z-index:1000;display:grid;place-items:center;pointer-events:auto}
  .lb-content{position:relative;width:100%;height:100%}
  .lb-image-wrap{position:absolute;inset:64px 64px 64px 64px}
  .lb-close,.lb-prev,.lb-next{position:absolute;z-index:1001;display:grid;place-items:center;width:40px;height:40px;border-radius:999px;background:var(--color-bg-elev);border:var(--border);box-shadow:var(--shadow-1);cursor:pointer}
  .lb-close{top:16px;right:16px}
  .lb-prev{left:16px;top:50%;transform:translateY(-50%)}
  .lb-next{right:16px;top:50%;transform:translateY(-50%)}
  @media (max-width: 700px){
    .lb-image-wrap{inset:56px 12px 56px 12px}
  }
}
